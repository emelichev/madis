<script>
    $(document).ready(function() {
        $('.conformite-organisation-reponse').each(function(div) {
            var parentId = $( this ).attr('id');
            var idDivInputRado = parentId + '_reponse';
            var idReponse0 = $( '#' + parentId + '_reponse_0');
            var idReponseRaison = $( '#' + parentId + '_reponseRaison' );
            var inputName = $( '#' + idDivInputRado + ' label:first-child input' ).first().attr('name');

            if (idReponse0.is(':checked')) {
                idReponseRaison.show();
                idReponseRaison.prop("required", true);
            } else {
                idReponseRaison.hide();
            }

            $("input[name='"+ inputName +"']").change(function(e){
                if($(this).val() == -1) {
                    idReponseRaison.show();
                    idReponseRaison.prop("required", true);
                } else {
                    idReponseRaison.hide();
                    idReponseRaison.prop("required", false);
                    idReponseRaison.val("");
                }

            });
        });

        $( "input[name='evaluation[saveDraft]']" ).on("click", function(e) {
            removeRequiredFields();
        });

        addAttribute();

    });

    /**
     * removeRequiredFields :: Unit -> Unit
     * remove all required fields in form named 'evaluation'
     */
    function removeRequiredFields () {
        const form = $("form[name='evaluation']");
        form.find('input').each(function(){
            $(this).prop('required',false);
        });
    }

    function addAttribute(){
        var elementExiste = false;
        if ($('[data-id^="evaluation_conformites"]').length > 0){
            $('[data-id^="evaluation_conformites"]').each(function() {
                $(this).attr('aria-label', 'Actions de protections');
            });
            elementExiste = true;
        } else {
            setTimeout(addAttribute, 1000);
        }
    }
</script>
