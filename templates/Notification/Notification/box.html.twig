{% set notifs = notifications.findAll()  %}
{% set unreadNotifs = notifs|filter(n => n.readAt is not defined or n.readAt is null) %}
{% set notifsObject = notifs|map(n => ({id : n.id, read_at: n.readAt})) %}
{% block body %}
{% set notifs = notifications.findAll()  %}
{% set unreadNotifs = notifs|filter(n => n.readAt is not defined or n.readAt is null) %}
{% set notifsObject = notifs|map(n => ({id : n.id, read_at: n.readAt})) %}
    <div class="box-header with-border" style="list-style: none;">
        <h3 class="box-title">Vous avez {{ unreadNotifs|length }} notifications non lues</h3>
        {% if unreadNotifs|length > 0 %}
            <a aria-label="{{ 'notification.notification.action.mark_as_read_all'|trans }}" id="read-all" href="{{ path('notification_notification_mark_as_read_all') }}" style="float:right;">{{ 'notification.notification.action.mark_as_read_all'|trans }}</a>
        {% endif %}
    </div>

    <div class="box-body">
    {% if unreadNotifs|length > 0 %}
        <ul>
    {% for notif in unreadNotifs %}
        {% if loop.index0 < app_notification_max_shown %}
            <li class="box-header with-border single-notification" style="padding: 0.8em;">
                <div class="row">
                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="col-md-8" href="#">
                    {% else %}
                        <div class="col-md-12" href="#">
                    {% endif %}
                            {{ notif | sentence | raw }}
                    </div>
                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="col-md-4 text-center">
                            <a aria-label="{{ 'notification.notification.action.mark_as_read'|trans }}" href="{{ path('notification_notification_mark_as_read', { 'id': notif.id }) }}" class="btn btn-block text-info" style="border-color: #31708f;background-color:white;">
                                <i class="fas fa-clipboard-check"></i> {{ 'notification.notification.action.mark_as_read'|trans }}
                            </a>
                        </div>
                    {% endif %}
                </div>
            </li>
        {% endif %}
    {% endfor %}
        </ul>
    {% endif %}

    {% if unreadNotifs|length == 0 %}
    <div class="text-center p-2">Il n'y a aucune notification non lue</div>
    {% endif %}

    {% set notifsLeft = unreadNotifs|length - app_notification_max_shown > 0 ? unreadNotifs|length - app_notification_max_shown : 0 %}
    <div class="text-center box-header">
        <a aria-label="Notifications" href="{{ path('notification_notification_list') }}">
            Voir toutes les notifications
            {% if unreadNotifs|length > app_notification_max_shown %} ({{ notifsLeft }} autres non lues) {% endif %}
        </a>
    </div>
    </div>
{% endblock %}


